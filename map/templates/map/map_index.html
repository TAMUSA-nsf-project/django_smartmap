{% extends "main/base.html" %}
{% load static %}

{% block extend_head %}
    <title>Add Map</title>
    {#   I don't think the following script is needed. Map still loads.   #}
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default" nonce="{{request.csp_nonce}}"></script>

    <style nonce="{{request.csp_nonce}}">
        /* Always set the mapindex height explicitly to define the size of the div
         * element that contains the mapindex. */
        #map {
            height: 100vh; /* Google's suggested height of 100% may prevent map from displaying */
        }
        .btn.btn-map-left {
            position: absolute;
            z-index: 10;
        }
    </style>

    <script type="text/javascript" nonce="{{request.csp_nonce}}">
        const MAP_CENTER = {lat: {{ lat_coord }}, lng: {{ lng_coord }}}
        const ALL_ACTIVE_ROUTES = {{ all_routes | safe }};
        const ROUTE_DETAILS = "{% url 'map:routedetails-ajax' %}"
        const AJAX_EST_ARRIVAL_URL = "{% url 'bus:busestarrival-ajax' %}"
        const AJAX_URL_ACTIVE_BUSSES_ON_ROUTE = "{% url 'bus:activebussesonroute-ajax' %}"
        const AJAX_URL_ROUTE_POLYLINE_ENCODING = "{% url 'bus:busroutepolyline-ajax' %}"
    </script>

    <script type="text/javascript" nonce="{{request.csp_nonce}}" src="{% static 'map/js/map_index.js' %}"></script>

    <!-- Front-end stuff -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

{% endblock %}


{% block content %}
    <button class="btn btn-primary btn-map-left" type="button" data-bs-toggle="offcanvas" data-bs-target="#leftOffcanvas" aria-controls="offcanvasExample">
      Routes
    </button>

    <!--The div element for the mapindex -->
    <div id="map"></div>

    <div class="offcanvas offcanvas-start" data-bs-scroll="true" data-bs-backdrop="false" tabindex="-1" id="leftOffcanvas" aria-labelledby="offcanvasExampleLabel">
      <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="offcanvasExampleLabel">Offcanvas</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
      </div>
      <div class="offcanvas-body">
        <div id="leftOffcanvasContent">

            <div class="accordion accordion-flush" id="leftOffcanvasAccordion">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="headingOne">
                      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                        Accordion Item #1
                      </button>
                    </h2>
                    <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
                      <div class="accordion-body">
                          <div class="container">
                              <div class="row">
                                  <div class="col">
                                      <i class="fa-solid fa-circle-dot"></i>
                                  </div>
                                  <div class="col">
                                      <div class="row">Route number</div>
                                      <div class="row">Stop name</div>
                                      <div class="row">ETA</div>
                                  </div>
                              </div>
                          </div>
                      </div>
                    </div>
                  </div>
                <script type="text/javascript" src={% static "map/js/offcanvas.js" %}> </script>
            </div>

        </div>
      </div>
    </div>

    <!--
     The `defer` attribute causes the callback to execute after the full HTML
     document has been parsed. For non-blocking uses, avoiding race conditions,
     and consistent behavior across browsers, consider loading using Promises
     with https://www.npmjs.com/package/@googlemaps/js-api-loader.

     DO NOT use the `async` attribute that is shown in some example html in Google's tutorials, the map may not
     load.
    -->
    <script
            src="https://maps.googleapis.com/maps/api/js?key={{ google_api_key|safe }}&callback=initMap&v=weekly" defer nonce="{{request.csp_nonce}}">
    </script>
{% endblock %}
